--有效期
alter table SAL_VOUCHERORDER add [VAILD_DATE] int NULL;
--面值
alter table SAL_VOUCHERORDER add [VOUCHER_PRC] int NULL;
--礼券名称
alter table SAL_VOUCHERORDER add [VUCH_NAME] varchar(50) NULL;
--序号
alter table SAL_VOUCHERDATA add [SEQNO] int NULL;


--代金券领用
drop table SAL_VHLEADDATA;
CREATE TABLE [SAL_VHLEADDATA] (
        --企业代码
	[TENANT_ID] int NOT NULL ,
        --领用单号
	[VHLEAD_ID] [char] (36) NOT NULL ,
        --领用的入库单号
	[VOUCHER_ID] [varchar] (36) NOT NULL ,
        --摘要
	[SUMMARY] [varchar](100)   NOT NULL,
        --领用张数
	[AMOUNT] [decimal](18, 3) NULL ,
        --面值
	[VOUCHER_PRC] int NOT NULL ,
        --面值金额
	[VOUCHER_TTL] [decimal](18, 3) NULL ,
	CONSTRAINT [PK_SAL_VHLEADDATA] PRIMARY KEY   
	(
		[TENANT_ID],[VHLEAD_ID],[VOUCHER_ID]
	) 
);

CREATE INDEX IX_SAL_VHLEADDATA_TENANT_ID ON SAL_VHLEADDATA(TENANT_ID);
CREATE INDEX IX_SAL_VHLEADDATA_VHLEAD_ID ON SAL_VHLEADDATA(TENANT_ID,VHLEAD_ID);


--代金券发放
drop table SAL_VHSENDDATA;
CREATE TABLE [SAL_VHSENDDATA] (
        --企业代码
	[TENANT_ID] int NOT NULL ,
        --发放单号
	[VHSEND_ID] [char] (36) NOT NULL ,
        --领用的入库单号
	[VOUCHER_ID] [varchar] (36) NOT NULL ,
        --防伪码--不记名时 为 #
	[BARCODE] [varchar] (50) NOT NULL ,
        --领用张数
	[AMOUNT] [decimal](18, 3) NULL ,
        --面值
	[VOUCHER_PRC] int NOT NULL ,
        --面值金额
	[VOUCHER_TTL] [decimal](18, 3) NULL ,
        --实收金额
	[VOUCHER_MNY] [decimal](18, 3) NULL ,
        --折扣率
	[AGIO_RATE] [decimal](18, 3) NULL ,
        --折扣额
	[AGIO_MONEY] [decimal](18, 3) NULL ,
	CONSTRAINT [PK_SAL_VHSEADDATA] PRIMARY KEY   
	(
		[TENANT_ID],[VHSEND_ID],[VOUCHER_ID],[BARCODE]
	) 
);

CREATE INDEX IX_SAL_VHSENDDATA_TENANT_ID ON SAL_VHSENDDATA(TENANT_ID);
CREATE INDEX IX_SAL_VHSENDDATA_VHSEND_ID ON SAL_VHSENDDATA(TENANT_ID,VHSEND_ID);

--财务系统编码对照
alter table CA_SHOP_INFO add SUBJECT_NO varchar(30) NULL;
alter table CA_DEPT_INFO add SUBJECT_NO varchar(30) NULL;
alter table CA_USERS add SUBJECT_NO varchar(30) NULL;
alter table PUB_CLIENTINFO add SUBJECT_NO varchar(30) NULL;

--凭证模块
DROP TABLE ACC_FVCHFRAME;
CREATE TABLE [ACC_FVCHFRAME] (
  --企业代码
  [TENANT_ID] int  NOT NULL,
  --单据类型 01采购订单 02采购进货 03采购退货 04 销售订单 05 销售出货 06销售退货 07领用单 08 损益单 09收款单 10 付款单  11 零售单据 12缴款单 13 其他收入 14其他支出 15 存取款单
  [FVCH_GTYPE] [char](2)   NOT NULL,
  --序号
  [SEQNO] [int] NOT NULL ,
  --科目代码
  [SUBJECT_NO] [varchar](10)   NOT NULL,
  --凭证字
  [FVCH_NAME] [varchar](20)   NOT NULL,
  --摘要
  [SUMMARY] [varchar](100)   NOT NULL,
        --金额<取数字段>
	[AMONEY] [varchar](20) NULL,
        --数量<取数字段>
	[AMOUNT] [varchar](20) NULL,
        --单价<取数字段>
	[APRICE] [varchar](20) NULL,
  --取数条件=>ACC_FVCHSWHERE
  [SWHERE] [char](36) NULL,
  --分录明细 100000000 按位取数0代表不分细明1表代分明细(1人员 2部门 3门店<仓库> 4往来单位 其他分别为专项1-5)
  [DATAFLAG] [varchar](9)   NOT NULL,
  --记账方向  1借方 2贷方
  [SUBJECT_TYPE] [char](1) NOT NULL,
  CONSTRAINT [PK_ACC_FVCHFRAME] PRIMARY KEY 
  ( 
		[TENANT_ID],
		[FVCH_GTYPE],
    [SEQNO]
  )
);
CREATE INDEX IX_ACC_FVCHFRAME_TENANT_ID ON ACC_FVCHFRAME (TENANT_ID);
CREATE INDEX IX_ACC_FVCHFRAME_FVCH_GTYPE ON ACC_FVCHFRAME (TENANT_ID,FVCH_GTYPE);

--凭证模块条件
CREATE TABLE [ACC_FVCHSWHERE] (
  --企业代码
  [TENANT_ID] int  NOT NULL,
  --行号
  [SROW_ID] [char](36)   NOT NULL,
  --条件ID
  [SWHERE] [char](36)   NOT NULL,
  --条件字段
  [FIELD_NAME] [varchar](30)   NOT NULL,
  --操作符 in 或 not in
	[FIELD_EQUE] [varchar](6) NULL,
  --字段值
  [FIELD_VALUE] [varchar](50) NULL,
  CONSTRAINT [PK_ACC_FVCHSWHERE] PRIMARY KEY 
  ( 
		[TENANT_ID],
		[SROW_ID]
  )
);
CREATE INDEX IX_ACC_FVCHSWHERE_TENANT_ID ON ACC_FVCHSWHERE (TENANT_ID);
CREATE INDEX IX_ACC_FVCHSWHERE_SWHERE ON ACC_FVCHSWHERE (TENANT_ID,SWHERE);

--单据类型
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('01','采购订单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('02','采购进货','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('03','采购退货','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('04','销售订单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('05','销售出货','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('06','销售退货','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('07','领用单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('08','损益单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('09','收款单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('10','付款单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('11','零售单据','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('12','缴款单','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('13','其他收入','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('14','其他支出','BILL_NAME','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('15','存取款单','BILL_NAME','00',5497000);

--取数字段定义 采购订单(FVCH_DATA_(单据代码01))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','进项税额','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ADVA_MNY','预付款','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('BOND_MNY','保证金','FVCH_DATA_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('OTHR_MNY','其他费用','FVCH_DATA_01','00',5497000);
--取数条件定义 采购订单(FVCH_WHERE_(单据代码01))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','供应商','FVCH_WHERE_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','采购员','FVCH_WHERE_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_01','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_01','00',5497000);

--取数字段定义 采购进货(FVCH_DATA_(单据代码02))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','进项税额','FVCH_DATA_02','00',5497000);
--取数条件定义 采购进货(FVCH_WHERE_(单据代码02))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','供应商','FVCH_WHERE_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','收货员','FVCH_WHERE_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_02','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_02','00',5497000);

--取数字段定义 采购退货(FVCH_DATA_(单据代码03))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','进项税额','FVCH_DATA_03','00',5497000);
--取数条件定义 采购退货(FVCH_WHERE_(单据代码03))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','供应商','FVCH_WHERE_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','收货员','FVCH_WHERE_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_03','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_03','00',5497000);

--取数字段定义 销售订单(FVCH_DATA_(单据代码04))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','销项税额','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ADVA_MNY','预收款','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('BOND_MNY','保证金','FVCH_DATA_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('OTHR_MNY','其他费用','FVCH_DATA_04','00',5497000);
--取数条件定义 销售订单(FVCH_WHERE_(单据代码04))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','客户名称','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','导购员','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_04','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SALES_STYLE','销售方式','FVCH_WHERE_04','00',5497000);

--取数字段定义 销售出货(FVCH_DATA_(单据代码05))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','销项税额','FVCH_DATA_05','00',5497000);
--取数条件定义 销售出货(FVCH_WHERE_(单据代码05))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','客户名称','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','导购员','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_05','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SALES_STYLE','销售方式','FVCH_WHERE_05','00',5497000);

--取数字段定义 销售退货(FVCH_DATA_(单据代码06))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','销项税额','FVCH_DATA_06','00',5497000);
--取数条件定义 销售退货(FVCH_WHERE_(单据代码06))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','客户名称','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','导购员','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_06','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SALES_STYLE','销售方式','FVCH_WHERE_06','00',5497000);

--取数字段定义 领用单 (FVCH_DATA_(单据代码07))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_07','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('COST_APRICE','成本价','FVCH_DATA_07','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('COST_MONEY','成本金额','FVCH_DATA_07','00',5497000);
--取数条件定义 领用单 (FVCH_WHERE_(单据代码07))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_07','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_07','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_07','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DUTY_USER','经手人','FVCH_WHERE_07','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_07','00',5497000);

--取数字段定义 损益单 (FVCH_DATA_(单据代码08))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_08','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('COST_APRICE','成本价','FVCH_DATA_08','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('COST_MONEY','成本金额','FVCH_DATA_08','00',5497000);
--取数条件定义 损益单 (FVCH_WHERE_(单据代码08))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_08','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_08','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_08','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DUTY_USER','经手人','FVCH_WHERE_08','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_08','00',5497000);

--取数字段定义 收款单 (FVCH_DATA_(单据代码09))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('RECV_MNY','收款金额','FVCH_DATA_09','00',5497000); 
--取数条件定义 收款单 (FVCH_WHERE_(单据代码09))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_09','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_09','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ITEM_ID','收支科目','FVCH_WHERE_09','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('PAYM_ID','收款方式','FVCH_WHERE_09','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','客户名称','FVCH_WHERE_09','00',5497000);

--取数字段定义 付款单 (FVCH_DATA_(单据代码10))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('RECV_MNY','付款金额','FVCH_DATA_10','00',5497000); 
--取数条件定义 付款单 (FVCH_WHERE_(单据代码10))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_10','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_10','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ITEM_ID','收支科目','FVCH_WHERE_10','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('PAYM_ID','付款方式','FVCH_WHERE_10','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','供应商','FVCH_WHERE_10','00',5497000);

--取数字段定义 零售单据 (FVCH_DATA_(单据代码11))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_AMOUNT','数量','FVCH_DATA_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('APRICE','单价','FVCH_DATA_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CALC_MONEY','含税金额','FVCH_DATA_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('NOTAX_MONEY','不含税金额','FVCH_DATA_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TAX_MONEY','销项税额','FVCH_DATA_11','00',5497000);

--取数条件定义 零售单据 (FVCH_WHERE_(单据代码11))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SORT_ID','商品指标','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','客户名称','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('GUIDE_USER','收银员','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('INVOICE_FLAG','票据类型','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IS_PRESENT','是否赠品','FVCH_WHERE_11','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SALES_STYLE','销售方式','FVCH_WHERE_11','00',5497000);

--取数字段定义 缴款单 (FVCH_DATA_(单据代码12))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('RECV_MNY','缴款金额','FVCH_DATA_12','00',5497000); 
--取数条件定义 缴款单 (FVCH_WHERE_(单据代码12))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_12','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_12','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ITEM_ID','收支科目','FVCH_WHERE_12','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('PAYM_ID','缴款方式','FVCH_WHERE_12','00',5497000);
 
--取数字段定义 其他收入 (FVCH_DATA_(单据代码13))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IORO_MNY','金额','FVCH_DATA_13','00',5497000); 
--取数条件定义 其他收入 (FVCH_WHERE_(单据代码13))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_13','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_13','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','往来单位','FVCH_WHERE_13','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ITEM_ID','收支科目','FVCH_WHERE_13','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IORO_USER','经手人','FVCH_WHERE_13','00',5497000);
 
--取数字段定义 其他支出 (FVCH_DATA_(单据代码14))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IORO_MNY','金额','FVCH_DATA_14','00',5497000); 
--取数条件定义 其他支出 (FVCH_WHERE_(单据代码14))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('DEPT_ID','部门','FVCH_WHERE_14','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_14','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('CLIENT_ID','往来单位','FVCH_WHERE_14','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('ITEM_ID','收支科目','FVCH_WHERE_14','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('IORO_USER','经手人','FVCH_WHERE_14','00',5497000);

--取数字段定义 存取款单 (FVCH_DATA_(单据代码15))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TRANS_MNY','金额','FVCH_DATA_15','00',5497000); 
--取数条件定义 其他支出 (FVCH_WHERE_(单据代码15))
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('SHOP_ID','门店','FVCH_WHERE_15','00',5497000);
insert into PUB_PARAMS(CODE_ID,CODE_NAME,TYPE_CODE,COMM,TIME_STAMP) values('TRANS_USER','经手人','FVCH_WHERE_15','00',5497000);


--客户商品销售账
drop table RCK_C_GOODS_DAYS ;
CREATE TABLE RCK_C_GOODS_DAYS (
        --企业代码
	TENANT_ID int NOT NULL ,
        --门店
	SHOP_ID varchar (13) NOT NULL ,
        --部门
	DEPT_ID varchar (12) NOT NULL ,
        --客户
	CLIENT_ID varchar (36) NOT NULL ,
        --销售日期
	CREA_DATE int NOT NULL ,
        --客户编码
	GODS_ID char (36)  NOT NULL ,
        --导购员
	GUIDE_USER varchar (36) NOT NULL ,
        --批号
	BATCH_NO varchar (36) NOT NULL ,
        --赠送标志
	IS_PRESENT int NOT NULL ,
        --销售方式
	SALES_STYLE varchar (36) NOT NULL ,

	--销售类台账	
        --销售数量<含退货>
	SALE_AMT decimal(18, 3)  null,
        --可销售额<按零售价>
	SALE_RTL decimal(18, 3)  null,
        --让利金额<销售让利>
	SALE_AGO decimal(18, 3)  null,
        --销售金额<末税>
	SALE_MNY decimal(18, 3)  null,
        --销项税额
	SALE_TAX decimal(18, 3)  null,
        --销售成本
	SALE_CST decimal(18, 3)  null,
        --成本单价<移动加权成本>
	COST_PRICE decimal(18, 6)  null,
        --销售毛利
	SALE_PRF decimal(18, 3)  null,	
        --其中退货数量
	SALRT_AMT decimal(18, 3)  null,
        --销售金额<末税>
	SALRT_MNY decimal(18, 3)  null,
        --销项税额
	SALRT_TAX decimal(18, 3)  null,
        --退货成本
	SALRT_CST decimal(18, 3)  null,	
        --通讯标志
	COMM varchar (2) NOT NULL DEFAULT '00',
        --时间戳 
	TIME_STAMP bigint NOT NULL
);
CREATE INDEX IX_RCK_C_GOODS_DAYS_TENANT_ID ON RCK_C_GOODS_DAYS(TENANT_ID);
CREATE INDEX IX_RCK_C_GOODS_DAYS_TIME_STAMP ON RCK_C_GOODS_DAYS(TENANT_ID,TIME_STAMP);
CREATE INDEX IX_RCK_C_GOODS_DAYS_CREA_DATE ON RCK_C_GOODS_DAYS(TENANT_ID,CREA_DATE);
CREATE INDEX IX_RCK_C_GOODS_DAYS_GODS_ID ON RCK_C_GOODS_DAYS(TENANT_ID,GODS_ID);
CREATE INDEX IX_RCK_C_GOODS_DAYS_CLIENT_ID ON RCK_C_GOODS_DAYS(TENANT_ID,CLIENT_ID);
CREATE INDEX IX_RCK_C_GOODS_DAYS_DEPT_ID ON RCK_C_GOODS_DAYS(TENANT_ID,DEPT_ID);

insert into RCK_C_GOODS_DAYS(TENANT_ID,SHOP_ID,DEPT_ID,GUIDE_USER,CLIENT_ID,CREA_DATE,GODS_ID,BATCH_NO,IS_PRESENT,SALES_STYLE,
SALE_AMT,SALE_RTL,SALE_AGO,SALE_MNY,SALE_TAX,SALE_CST,COST_PRICE,SALE_PRF,SALRT_AMT,SALRT_MNY,SALRT_TAX,SALRT_CST,COMM,TIME_STAMP) 
select A.TENANT_ID,A.SHOP_ID,
case when A.DEPT_ID is null then '#' else A.DEPT_ID end,
case when A.GUIDE_USER is null then '#' else A.GUIDE_USER end,
case when A.CLIENT_ID is null then '#' else A.CLIENT_ID end,
A.SALES_DATE,A.GODS_ID,A.BATCH_NO,A.IS_PRESENT,
case when A.SALES_STYLE is null then '#' else A.SALES_STYLE end, 
sum(A.CALC_AMOUNT) as SALE_AMT,sum(A.CALC_MONEY+A.AGIO_MONEY) as SALE_RTL,sum(A.AGIO_MONEY) as SALE_AGO,sum(A.NOTAX_MONEY) as SALE_MNY,sum(A.TAX_MONEY) as SALE_TAX, 
sum(round(A.CALC_AMOUNT*B.COST_PRICE,2)) as SALE_CST,max(B.COST_PRICE) as COST_PRICE, 
sum(A.NOTAX_MONEY-round(A.CALC_AMOUNT*B.COST_PRICE,2)) as SALE_PRF, 
sum(case when A.SALES_TYPE=3 then A.CALC_AMOUNT else 0 end) as SALRT_AMT, 
sum(case when A.SALES_TYPE=3 then A.NOTAX_MONEY else 0 end) as SALRT_MNY, 
sum(case when A.SALES_TYPE=3 then A.TAX_MONEY else 0 end) as SALRT_TAX, 
sum(case when A.SALES_TYPE=3 then round(A.CALC_AMOUNT*B.COST_PRICE,2) else 0 end) as SALRT_CST, 
'00',strftime('%s','now','localtime')-1293840000 from VIW_SALESDATA A,RCK_GOODS_DAYS B 
where A.TENANT_ID=B.TENANT_ID and A.SHOP_ID=B.SHOP_ID and A.SALES_DATE=B.CREA_DATE and A.GODS_ID=B.GODS_ID and A.BATCH_NO=B.BATCH_NO  
group by A.TENANT_ID,A.SHOP_ID,
case when A.GUIDE_USER is null then '#' else A.GUIDE_USER end,
case when A.DEPT_ID is null then '#' else A.DEPT_ID end,
case when A.CLIENT_ID is null then '#' else A.CLIENT_ID end,
A.SALES_DATE,A.GODS_ID,A.BATCH_NO,A.IS_PRESENT,
case when A.SALES_STYLE is null then '#' else A.SALES_STYLE end;